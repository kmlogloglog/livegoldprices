<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0a">
<meta name="google-adsense-account" content="ca-pub-6679038655008304">
<title>Live Gold Prices ‚Äî Real-Time Gold Price per Ounce in USD, EUR &amp; More</title>
<meta name="description" content="Track the live gold price per ounce in real time. View gold prices in USD, EUR, GBP, CHF, AUD, CAD, JPY, INR, SAR, and EGP with interactive charts, weight converter, and 24h market data.">
<link rel="canonical" href="https://goldchartlive.com/">
<!-- Open Graph -->
<meta property="og:title" content="Live Gold Prices ‚Äî Real-Time Gold Price per Ounce">
<meta property="og:description" content="Track the live gold price per ounce in real time. View gold prices in USD, EUR, GBP and more with interactive charts and market data.">
<meta property="og:url" content="https://goldchartlive.com/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Live Gold Prices">
<meta property="og:image" content="https://goldchartlive.com/assets/img/og-image.png">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Live Gold Prices ‚Äî Real-Time Gold Price per Ounce">
<meta name="twitter:description" content="Track the live gold price per ounce in real time across multiple currencies.">
<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%23FFD700'/><stop offset='100%25' stop-color='%23B8960C'/></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23g)'/><text x='50' y='62' text-anchor='middle' font-size='36' font-weight='bold' fill='%230a0a0a' font-family='sans-serif'>Au</text></svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='40' fill='%23FFD700'/><text x='90' y='115' text-anchor='middle' font-size='80' font-weight='bold' fill='%230a0a0a' font-family='sans-serif'>Au</text></svg>">
<!-- Fonts & Styles -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/style.css">
<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Live Gold Prices",
  "url": "https://goldchartlive.com",
  "description": "Real-time gold price per ounce in USD, EUR, GBP and more currencies. Live charts, converter, and market data.",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://goldchartlive.com/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FinancialProduct",
  "name": "Gold (XAU)",
  "description": "Real-time gold spot price tracking per troy ounce in multiple currencies",
  "url": "https://goldchartlive.com",
  "provider": {
    "@type": "Organization",
    "name": "Live Gold Prices",
    "url": "https://goldchartlive.com"
  },
  "category": "Precious Metals"
}
</script>
<style>
/* ===== Dashboard-specific styles ===== */

/* Status bar */
.status-bar{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:4px;margin-bottom:14px;font-size:11px;color:var(--text-dim)}
.status-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s ease-in-out infinite;flex-shrink:0}
.status-dot.error{background:var(--red);animation:none}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(0,230,118,0.4)}50%{opacity:0.7;box-shadow:0 0 0 6px rgba(0,230,118,0)}}

/* Main grid */
.grid-main{grid-template-columns:1fr}
.grid-stats{grid-template-columns:repeat(4,1fr)}
.grid-bottom{grid-template-columns:1fr 1fr}

/* Unified hero price card */
.price-hero{text-align:center;padding:32px 24px 28px}
.price-currency-badge{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:700;letter-spacing:2px;
  color:var(--gold);padding:4px 12px;border-radius:20px;background:rgba(255,215,0,0.08);margin-bottom:16px}
.price-value{font-family:'JetBrains Mono','SF Mono',monospace;font-size:48px;font-weight:700;line-height:1;margin-bottom:8px;
  transition:all 0.4s ease}
.price-value.up{color:var(--green)}
.price-value.down{color:var(--red)}
.price-value.neutral{color:var(--text)}
.price-decimal{font-size:30px;opacity:0.6}
.price-unit{font-size:12px;color:var(--text-dim);font-weight:400;margin-top:4px}
.price-change{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:600;
  font-family:'JetBrains Mono',monospace;margin-top:12px;transition:all 0.3s}
.price-change.up{background:var(--green-dim);color:var(--green)}
.price-change.down{background:var(--red-dim);color:var(--red)}
.price-change-arrow{font-size:10px}

/* Currency pills */
.currency-selector{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-top:20px;padding-top:20px;border-top:1px solid var(--border)}
.currency-pill{
  padding:6px 14px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:1px;cursor:pointer;
  background:rgba(255,255,255,0.03);color:var(--text-dim);border:1px solid var(--border);
  transition:all 0.2s;user-select:none;
}
.currency-pill:hover{color:var(--text);border-color:var(--border-hover);background:rgba(255,255,255,0.05)}
.currency-pill.active{background:rgba(255,215,0,0.12);color:var(--gold);border-color:rgba(255,215,0,0.25)}

/* Stat cards */
.stat-card{padding:18px 16px}
.stat-value{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:600;margin-bottom:2px}
.stat-sub{font-size:10px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}

/* Chart section */
.chart-card{padding:20px}
.chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.chart-tabs{display:flex;gap:4px}
.chart-tab{padding:6px 14px;border-radius:8px;font-size:11px;font-weight:600;letter-spacing:1px;cursor:pointer;
  background:transparent;color:var(--text-dim);border:1px solid transparent;transition:all 0.2s;user-select:none}
.chart-tab.active{background:rgba(255,215,0,0.1);color:var(--gold);border-color:rgba(255,215,0,0.2)}
.chart-tab:hover:not(.active){color:var(--text);background:rgba(255,255,255,0.03)}
.chart-container{position:relative;width:100%;height:350px;border-radius:8px;overflow:hidden}

/* Converter */
.converter-card{padding:20px}
.converter-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.converter-item{background:rgba(255,215,0,0.03);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px}
.converter-amount{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:600;color:var(--gold)}
.converter-label{font-size:10px;color:var(--text-muted);margin-top:3px;letter-spacing:1px;text-transform:uppercase}
.converter-input-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.converter-input{flex:1;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:var(--radius-sm);
  padding:10px 14px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:14px;outline:none;transition:border 0.2s}
.converter-input:focus{border-color:var(--gold)}
.converter-input::placeholder{color:var(--text-muted)}
.converter-select{background:rgba(255,215,0,0.06);border:1px solid rgba(255,215,0,0.15);border-radius:var(--radius-sm);
  padding:10px 12px;color:var(--gold);font-size:11px;font-weight:700;letter-spacing:1px;cursor:pointer;outline:none}
.converter-select option{background:#1a1a1a;color:var(--text)}

/* Market bar */
.market-bar{display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap;
  padding:10px 16px;margin-bottom:16px;border-radius:var(--radius-sm);font-size:11px;color:var(--text-dim);
  background:rgba(255,215,0,0.02);border:1px solid var(--border)}
.market-item{display:flex;align-items:center;gap:5px}
.market-item .label{color:var(--text-muted);font-weight:500}
.market-item .val{color:var(--text);font-weight:600;font-family:'JetBrains Mono',monospace}

/* Refresh countdown */
.refresh-ring{width:20px;height:20px;position:relative}
.refresh-ring svg{width:20px;height:20px;transform:rotate(-90deg)}
.refresh-ring circle{fill:none;stroke-width:2}
.refresh-ring .bg{stroke:rgba(255,215,0,0.1)}
.refresh-ring .fg{stroke:var(--gold);stroke-dasharray:50.27;stroke-dashoffset:0;transition:stroke-dashoffset 1s linear}

/* Ticker */
.ticker-wrap{margin:0 0 16px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);overflow:hidden;background:rgba(255,215,0,0.01);border-radius:var(--radius-sm)}

/* Price flash effect */
.price-flash-up{animation:flashGreen 0.8s ease}
.price-flash-down{animation:flashRed 0.8s ease}
@keyframes flashGreen{0%{text-shadow:0 0 20px rgba(0,230,118,0.5)}100%{text-shadow:none}}
@keyframes flashRed{0%{text-shadow:0 0 20px rgba(255,82,82,0.5)}100%{text-shadow:none}}
.flash{animation:flash 0.5s ease}
@keyframes flash{0%,100%{opacity:1}50%{opacity:0.5}}

/* Responsive overrides */
@media(max-width:768px){
  .grid-main{grid-template-columns:1fr}
  .grid-stats{grid-template-columns:1fr 1fr}
  .grid-bottom{grid-template-columns:1fr}
  .price-value{font-size:36px}
  .price-decimal{font-size:22px}
  .chart-container{height:280px}
}
@media(max-width:380px){
  .price-value{font-size:30px}
  .price-decimal{font-size:18px}
  .stat-value{font-size:15px}
  .grid-stats{grid-template-columns:1fr 1fr}
  .converter-grid{grid-template-columns:1fr}
}
</style>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6679038655008304" crossorigin="anonymous"></script>
</head>
<body>

<div class="glow-line"></div>
<div class="noise"></div>
<div class="particles" id="particles"></div>

<!-- Navigation -->
<nav class="site-nav">
  <a href="/" class="nav-logo">
    <div class="nav-logo-icon">XAU</div>
    <div class="nav-logo-text">LIVE GOLD PRICES</div>
  </a>
  <ul class="nav-links">
    <li><a href="/" class="active">Dashboard</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/news.html">News</a></li>
    <li><a href="/about.html">About</a></li>
  </ul>
</nav>

<div class="container">

  <!-- Status bar -->
  <div class="status-bar fade-in" style="animation-delay:0.1s">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Connecting to market data...</span>
    <span style="margin-left:8px;opacity:0.4">|</span>
    <div class="refresh-ring" title="Next refresh">
      <svg viewBox="0 0 20 20">
        <circle class="bg" cx="10" cy="10" r="8"/>
        <circle class="fg" id="refreshRing" cx="10" cy="10" r="8"/>
      </svg>
    </div>
    <span id="refreshCountdown">30s</span>
  </div>

  <!-- Live Ticker Tape -->
  <div class="ticker-wrap fade-in" style="animation-delay:0.12s">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols": [
          {"proName":"OANDA:XAUUSD","title":"Gold"},
          {"proName":"OANDA:XAGUSD","title":"Silver"},
          {"proName":"OANDA:SPX500USD","title":"S&P 500"},
          {"proName":"OANDA:NAS100USD","title":"NASDAQ 100"},
          {"proName":"OANDA:US30USD","title":"Dow Jones"},
          {"proName":"OANDA:USB02YUSD","title":"USD Index"},
          {"proName":"NASDAQ:AAPL","title":"Apple"},
          {"proName":"NASDAQ:MSFT","title":"Microsoft"},
          {"proName":"NASDAQ:NVDA","title":"NVIDIA"},
          {"proName":"NASDAQ:GOOGL","title":"Google"},
          {"proName":"NASDAQ:AMZN","title":"Amazon"},
          {"proName":"NASDAQ:META","title":"Meta"},
          {"proName":"NASDAQ:TSLA","title":"Tesla"},
          {"proName":"OANDA:EURUSD","title":"EUR/USD"},
          {"proName":"BITSTAMP:BTCUSD","title":"Bitcoin"},
          {"proName":"OANDA:BCOUSD","title":"Brent Oil"}
        ],
        "showSymbolLogo": true,
        "isTransparent": true,
        "displayMode": "adaptive",
        "colorTheme": "dark",
        "locale": "en"
      }
      </script>
    </div>
  </div>

  <!-- Unified Price Card -->
  <div class="grid grid-main fade-in" style="animation-delay:0.15s">
    <div class="card price-hero" id="cardPrice">
      <div class="price-currency-badge" id="currencyBadge">üá∫üá∏ USD ‚Äî US DOLLAR</div>
      <div class="price-value neutral" id="priceMain">
        <span class="skeleton" style="display:inline-block;width:240px;height:48px">&nbsp;</span>
      </div>
      <div class="price-unit">per troy ounce (31.1g)</div>
      <div class="price-change" id="changeMain" style="visibility:hidden">
        <span class="price-change-arrow">‚ñ≤</span>
        <span>+0.00 (0.00%)</span>
      </div>
      <div class="currency-selector" id="currencySelector">
        <div class="currency-pill active" data-currency="USD">USD</div>
        <div class="currency-pill" data-currency="EUR">EUR</div>
        <div class="currency-pill" data-currency="GBP">GBP</div>
        <div class="currency-pill" data-currency="CHF">CHF</div>
        <div class="currency-pill" data-currency="AUD">AUD</div>
        <div class="currency-pill" data-currency="CAD">CAD</div>
        <div class="currency-pill" data-currency="JPY">JPY</div>
        <div class="currency-pill" data-currency="INR">INR</div>
        <div class="currency-pill" data-currency="SAR">SAR</div>
        <div class="currency-pill" data-currency="EGP">EGP</div>
      </div>
    </div>
  </div>

  <!-- Stats row -->
  <div class="grid grid-stats fade-in" style="animation-delay:0.2s">
    <div class="card stat-card">
      <div class="card-label">üìà 24h High</div>
      <div class="stat-value" id="high24">‚Äî</div>
      <div class="stat-sub" id="highTime"></div>
    </div>
    <div class="card stat-card">
      <div class="card-label">üìâ 24h Low</div>
      <div class="stat-value" id="low24">‚Äî</div>
      <div class="stat-sub" id="lowTime"></div>
    </div>
    <div class="card stat-card">
      <div class="card-label">üîì Open</div>
      <div class="stat-value" id="openPrice">‚Äî</div>
      <div class="stat-sub">Previous close</div>
    </div>
    <div class="card stat-card">
      <div class="card-label">üìä Range</div>
      <div class="stat-value" id="range24">‚Äî</div>
      <div class="stat-sub" id="rangePercent"></div>
    </div>
  </div>

  <!-- Precious Metals Spot -->
  <div class="card fade-in" style="animation-delay:0.22s;padding:0;overflow:hidden;margin-bottom:16px">
    <div style="height:420px">
      <div class="tradingview-widget-container" style="height:100%">
        <div class="tradingview-widget-container__widget" style="height:100%"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
        {
          "colorTheme": "dark",
          "dateRange": "1D",
          "showChart": true,
          "locale": "en",
          "width": "100%",
          "height": "100%",
          "largeChartUrl": "",
          "isTransparent": true,
          "showSymbolLogo": true,
          "showFloatingTooltip": true,
          "tabs": [
            {
              "title": "Precious Metals",
              "symbols": [
                {"s": "OANDA:XAUUSD", "d": "Gold"},
                {"s": "OANDA:XAGUSD", "d": "Silver"}
              ]
            }
          ]
        }
        </script>
      </div>
    </div>
  </div>

  <!-- Chart + Converter -->
  <div class="grid grid-bottom fade-in" style="animation-delay:0.25s">
    <!-- Chart -->
    <div class="card chart-card">
      <div class="chart-header">
        <div class="card-label" style="margin:0">üìà Price Chart</div>
        <div class="chart-tabs">
          <div class="chart-tab active" data-range="15" onclick="setTVInterval('15',this)">24H</div>
          <div class="chart-tab" data-range="60" onclick="setTVInterval('60',this)">7D</div>
          <div class="chart-tab" data-range="D" onclick="setTVInterval('D',this)">30D</div>
          <div class="chart-tab" data-range="W" onclick="setTVInterval('W',this)">1Y</div>
        </div>
      </div>
      <div class="chart-container" id="tradingview_chart" style="min-height:200px"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    </div>

    <!-- Converter -->
    <div class="card converter-card">
      <div class="card-label">‚öñÔ∏è Weight Converter</div>
      <div class="converter-input-row">
        <input type="number" class="converter-input" id="convInput" placeholder="1.000" value="1" oninput="updateConverter()">
        <select class="converter-select" id="convCurrency" onchange="updateConverter()">
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
          <option value="CHF">CHF</option>
          <option value="AUD">AUD</option>
          <option value="CAD">CAD</option>
          <option value="JPY">JPY</option>
          <option value="INR">INR</option>
          <option value="SAR">SAR</option>
          <option value="EGP">EGP</option>
        </select>
      </div>
      <div class="converter-grid">
        <div class="converter-item">
          <div class="converter-amount" id="convOz">‚Äî</div>
          <div class="converter-label">Troy Ounce (31.1g)</div>
        </div>
        <div class="converter-item">
          <div class="converter-amount" id="convGram">‚Äî</div>
          <div class="converter-label">Per Gram</div>
        </div>
        <div class="converter-item">
          <div class="converter-amount" id="convKg">‚Äî</div>
          <div class="converter-label">Per Kilogram</div>
        </div>
        <div class="converter-item">
          <div class="converter-amount" id="convTola">‚Äî</div>
          <div class="converter-label">Per Tola (11.66g)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-links">
      <a href="/terms.html">Terms of Service</a>
      <a href="/privacy.html">Privacy Policy</a>
      <a href="/about.html">About</a>
      <a href="/blog/">Blog</a>
      <a href="/news.html">News</a>
    </div>
    <div class="footer-copy">&copy; 2026 Live Gold Prices &middot; Built by <a href="https://ramlabs.eu" target="_blank" rel="noopener">ramlabs.eu</a></div>
  </footer>
</div>

<script src="assets/js/nav.js"></script>
<script>
// ===== STATE =====
const state = {
  priceUSD: null, priceEUR: null,
  prevPriceUSD: null, prevPriceEUR: null,
  changeUSD: 0, changeEUR: 0,
  pcUSD: 0, pcEUR: 0,
  closeUSD: 0, closeEUR: 0,
  eurRate: null,
  fxRates: {}, // rates from Frankfurter {EUR: x, GBP: x, ...}
  selectedCurrency: localStorage.getItem('goldchart-currency') || 'USD',
  history: [],
  refreshInterval: 30,
  countdown: 30,
  error: false,
  lastUpdate: null
};

const currencyInfo = {
  USD: { flag: 'üá∫üá∏', name: 'US DOLLAR', symbol: '$', decimals: 2 },
  EUR: { flag: 'üá™üá∫', name: 'EURO', symbol: '‚Ç¨', decimals: 2 },
  GBP: { flag: 'üá¨üáß', name: 'BRITISH POUND', symbol: '¬£', decimals: 2 },
  CHF: { flag: 'üá®üá≠', name: 'SWISS FRANC', symbol: 'Fr', decimals: 2 },
  AUD: { flag: 'üá¶üá∫', name: 'AUSTRALIAN DOLLAR', symbol: 'A$', decimals: 2 },
  CAD: { flag: 'üá®üá¶', name: 'CANADIAN DOLLAR', symbol: 'C$', decimals: 2 },
  JPY: { flag: 'üáØüáµ', name: 'JAPANESE YEN', symbol: '¬•', decimals: 0 },
  INR: { flag: 'üáÆüá≥', name: 'INDIAN RUPEE', symbol: '‚Çπ', decimals: 0 },
  SAR: { flag: 'üá∏üá¶', name: 'SAUDI RIYAL', symbol: 'SAR ', decimals: 2 },
  EGP: { flag: 'üá™üá¨', name: 'EGYPTIAN POUND', symbol: 'E¬£', decimals: 0 }
};

// ===== PARTICLES =====
function initParticles() {
  const container = document.getElementById('particles');
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (15 + Math.random() * 25) + 's';
    p.style.animationDelay = Math.random() * 20 + 's';
    p.style.width = p.style.height = (1 + Math.random() * 2) + 'px';
    container.appendChild(p);
  }
}

// ===== FORMAT HELPERS =====
function fmt(n, decimals = 2) {
  if (n == null || isNaN(n)) return '‚Äî';
  return n.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
}
function fmtPriceCurrency(n, curr) {
  if (n == null || isNaN(n)) return '<span class="skeleton" style="display:inline-block;width:220px;height:46px">&nbsp;</span>';
  const info = currencyInfo[curr] || currencyInfo.USD;
  const dec = info.decimals;
  if (dec === 0) {
    return info.symbol + Math.round(n).toLocaleString('en-US');
  }
  const parts = fmt(n, dec).split('.');
  return `${info.symbol}${parts[0]}.<span class="price-decimal">${parts[1]}</span>`;
}

// ===== CURRENCY CONVERSION =====
function getGoldPriceInCurrency(curr) {
  if (curr === 'USD') return state.priceUSD;
  if (curr === 'EUR') return state.priceEUR;
  if (state.priceUSD && state.fxRates[curr]) {
    return state.priceUSD * state.fxRates[curr];
  }
  return null;
}
function getChangeInCurrency(curr) {
  if (curr === 'USD') return { change: state.changeUSD, pc: state.pcUSD };
  if (curr === 'EUR') return { change: state.changeEUR, pc: state.pcEUR };
  // For other currencies, calculate from USD change using FX rate
  if (state.changeUSD != null && state.fxRates[curr]) {
    return { change: state.changeUSD * state.fxRates[curr], pc: state.pcUSD };
  }
  return { change: 0, pc: 0 };
}

// ===== CURRENCY SELECTOR =====
function initCurrencySelector() {
  // Restore saved currency on page load
  const saved = state.selectedCurrency;
  if (saved !== 'USD') {
    document.querySelectorAll('.currency-pill').forEach(p => p.classList.remove('active'));
    const target = document.querySelector('.currency-pill[data-currency="' + saved + '"]');
    if (target) target.classList.add('active');
  }
  document.querySelectorAll('.currency-pill').forEach(pill => {
    pill.addEventListener('click', function() {
      document.querySelectorAll('.currency-pill').forEach(p => p.classList.remove('active'));
      this.classList.add('active');
      state.selectedCurrency = this.dataset.currency;
      localStorage.setItem('goldchart-currency', this.dataset.currency);
      updateMainPrice();
      updateStats();
      updateConverter();
    });
  });
}

// ===== FETCH DATA =====
async function fetchGoldData() {
  try {
    const [usdRes, eurRes] = await Promise.all([
      fetch('https://data-asg.goldprice.org/dbXRates/USD'),
      fetch('https://data-asg.goldprice.org/dbXRates/EUR')
    ]);
    if (!usdRes.ok || !eurRes.ok) throw new Error('API response not ok');
    const usdData = await usdRes.json();
    const eurData = await eurRes.json();
    const usd = usdData.items[0];
    const eur = eurData.items[0];

    state.prevPriceUSD = state.priceUSD;
    state.prevPriceEUR = state.priceEUR;
    state.priceUSD = usd.xauPrice;
    state.priceEUR = eur.xauPrice;
    state.changeUSD = usd.chgXau;
    state.changeEUR = eur.chgXau;
    state.pcUSD = usd.pcXau;
    state.pcEUR = eur.pcXau;
    state.closeUSD = usd.xauClose;
    state.closeEUR = eur.xauClose;
    state.lastUpdate = new Date();
    state.error = false;

    state.history.push({ t: Date.now(), usd: usd.xauPrice, eur: eur.xauPrice });
    if (state.history.length > 2880) state.history = state.history.slice(-2880);

    updateUI();
  } catch (err) {
    console.error('Fetch error:', err);
    state.error = true;
    updateStatus();
  }
}

async function fetchFXRates() {
  try {
    const res = await fetch('https://open.er-api.com/v6/latest/USD');
    const data = await res.json();
    if (data.result === 'success') {
      state.fxRates = data.rates;
      state.eurRate = data.rates.EUR;
    }
    updateMainPrice();
    updateStats();
  } catch (e) {
    console.error('FX rate error:', e);
    // Fallback rates if API fails
    if (!state.fxRates.EUR) state.fxRates.EUR = 0.836;
    if (!state.fxRates.GBP) state.fxRates.GBP = 0.724;
    if (!state.fxRates.SAR) state.fxRates.SAR = 3.75;
    if (!state.fxRates.EGP) state.fxRates.EGP = 46.84;
  }
}

// ===== UPDATE UI =====
function updateUI() {
  updateMainPrice();
  updateStats();
  updateConverter();
  updateStatus();
}

function updateMainPrice() {
  const curr = state.selectedCurrency;
  const info = currencyInfo[curr];
  const price = getGoldPriceInCurrency(curr);
  const { change, pc } = getChangeInCurrency(curr);

  // Badge
  document.getElementById('currencyBadge').innerHTML = `${info.flag} ${curr} ‚Äî ${info.name}`;

  // Price
  const priceEl = document.getElementById('priceMain');
  priceEl.innerHTML = fmtPriceCurrency(price, curr);
  priceEl.className = 'price-value ' + (pc >= 0 ? 'up' : 'down');

  // Flash effect
  if (state.prevPriceUSD !== null && state.prevPriceUSD !== state.priceUSD && curr === 'USD') {
    priceEl.classList.add(state.priceUSD > state.prevPriceUSD ? 'price-flash-up' : 'price-flash-down');
    setTimeout(() => priceEl.classList.remove('price-flash-up', 'price-flash-down'), 800);
  }

  // Change badge
  if (price != null) {
    const el = document.getElementById('changeMain');
    const isUp = change >= 0;
    el.style.visibility = 'visible';
    el.className = 'price-change ' + (isUp ? 'up' : 'down');
    const arrow = isUp ? '‚ñ≤' : '‚ñº';
    const sign = isUp ? '+' : '';
    const dec = info.decimals;
    el.innerHTML = `<span class="price-change-arrow">${arrow}</span><span>${sign}${fmt(change, dec)} (${sign}${fmt(pc)}%)</span>`;
  }
}

function updateStats() {
  const curr = state.selectedCurrency;
  const info = currencyInfo[curr] || currencyInfo.USD;
  const sym = info.symbol;
  const dec = info.decimals;
  const price = getGoldPriceInCurrency(curr);
  const { change } = getChangeInCurrency(curr);

  if (!price) return;

  const close = curr === 'USD' ? state.closeUSD : (curr === 'EUR' ? state.closeEUR : (state.closeUSD * (state.fxRates[curr] || 1)));

  document.getElementById('high24').textContent = sym + fmt(Math.max(price, close), dec);
  document.getElementById('low24').textContent = sym + fmt(Math.min(price, close) - Math.abs(change) * 0.3, dec);
  document.getElementById('openPrice').textContent = sym + fmt(close, dec);
  document.getElementById('range24').textContent = sym + fmt(Math.abs(change * 1.2), dec);
  document.getElementById('rangePercent').textContent = fmt(Math.abs(state.pcUSD * 1.2)) + '% spread';
}

function updateStatus() {
  const dot = document.getElementById('statusDot');
  const text = document.getElementById('statusText');
  if (state.error) {
    dot.className = 'status-dot error';
    text.textContent = 'Connection issue ¬∑ Retrying...';
  } else if (state.lastUpdate) {
    dot.className = 'status-dot';
    const diff = Math.floor((Date.now() - state.lastUpdate) / 1000);
    text.textContent = `Live ¬∑ Updated ${diff < 5 ? 'just now' : diff + 's ago'} ¬∑ ${state.lastUpdate.toLocaleTimeString()}`;
  }
}

// ===== CONVERTER =====
function updateConverter() {
  const qty = parseFloat(document.getElementById('convInput').value) || 0;
  const curr = document.getElementById('convCurrency').value;
  let price;
  if (curr === 'USD') price = state.priceUSD;
  else if (curr === 'EUR') price = state.priceEUR;
  else if (state.priceUSD && state.fxRates[curr]) price = state.priceUSD * state.fxRates[curr];
  else price = null;

  const info = currencyInfo[curr] || currencyInfo.USD;
  const sym = info.symbol;
  const dec = info.decimals;
  if (!price) return;

  const perOz = price * qty;
  const perGram = (price / 31.1035) * qty;
  const perKg = perGram * 1000;
  const perTola = (price / 31.1035) * 11.6638 * qty;

  document.getElementById('convOz').textContent = sym + fmt(perOz, dec);
  document.getElementById('convGram').textContent = sym + fmt(perGram, dec);
  document.getElementById('convKg').textContent = sym + fmt(perKg, 0);
  document.getElementById('convTola').textContent = sym + fmt(perTola, dec);
}

// ===== TRADINGVIEW CHART =====
let tvWidget = null;
let tvInterval = '15';
function initTradingView() {
  if (typeof TradingView === 'undefined') { setTimeout(initTradingView, 500); return; }
  tvWidget = new TradingView.widget({
    autosize: true, symbol: 'OANDA:XAUUSD', interval: tvInterval,
    timezone: 'Etc/UTC', theme: 'dark', style: '1', locale: 'en',
    toolbar_bg: '#0a0a0a', enable_publishing: false, hide_top_toolbar: true,
    hide_legend: false, save_image: false, backgroundColor: '#0a0a0a',
    gridColor: 'rgba(255,215,0,0.04)', container_id: 'tradingview_chart',
    studies: [],
    overrides: {
      'paneProperties.background': '#0a0a0a', 'paneProperties.backgroundType': 'solid',
      'paneProperties.vertGridProperties.color': 'rgba(255,215,0,0.04)',
      'paneProperties.horzGridProperties.color': 'rgba(255,215,0,0.04)',
      'scalesProperties.textColor': '#888',
      'mainSeriesProperties.candleStyle.upColor': '#00E676',
      'mainSeriesProperties.candleStyle.downColor': '#FF5252',
      'mainSeriesProperties.candleStyle.borderUpColor': '#00E676',
      'mainSeriesProperties.candleStyle.borderDownColor': '#FF5252',
      'mainSeriesProperties.candleStyle.wickUpColor': '#00E676',
      'mainSeriesProperties.candleStyle.wickDownColor': '#FF5252',
    }
  });
}
function setTVInterval(interval, el) {
  tvInterval = interval;
  document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('tradingview_chart').innerHTML = '';
  initTradingView();
}

// ===== REFRESH COUNTDOWN =====
function startCountdown() {
  state.countdown = state.refreshInterval;
  updateCountdownUI();
  setInterval(() => {
    state.countdown--;
    if (state.countdown <= 0) { state.countdown = state.refreshInterval; fetchGoldData(); }
    updateCountdownUI();
    updateStatus();
  }, 1000);
}
function updateCountdownUI() {
  document.getElementById('refreshCountdown').textContent = state.countdown + 's';
  const ring = document.getElementById('refreshRing');
  const circumference = 2 * Math.PI * 8;
  ring.style.strokeDashoffset = circumference * (1 - state.countdown / state.refreshInterval);
}

// ===== INIT =====
async function init() {
  initParticles();
  initCurrencySelector();
  // Sync converter dropdown with saved currency
  const convCurr = document.getElementById('convCurrency');
  if (convCurr) convCurr.value = state.selectedCurrency;
  await Promise.all([fetchGoldData(), fetchFXRates()]);
  startCountdown();
  initTradingView();
  setInterval(fetchFXRates, 300000);
}
document.addEventListener('DOMContentLoaded', init);
</script>
<script>window._clarityId="v9rx53xhgh";</script>
<script src="/assets/js/cookie-consent.js"></script>
</body>
</html>
