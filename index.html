<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0a">
<title>AURUM ‚Äî Live Gold Dashboard</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü•á</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --gold:#FFD700;--gold-dim:#B8960C;--gold-bright:#FFF0A0;--gold-dark:#8B7500;
  --bg:#0a0a0a;--bg-card:rgba(255,215,0,0.03);--bg-card-hover:rgba(255,215,0,0.06);
  --border:rgba(255,215,0,0.08);--border-hover:rgba(255,215,0,0.15);
  --text:#f0f0f0;--text-dim:#888;--text-muted:#555;
  --green:#00E676;--green-dim:rgba(0,230,118,0.1);
  --red:#FF5252;--red-dim:rgba(255,82,82,0.1);
  --glass:rgba(18,18,18,0.7);--glass-border:rgba(255,215,0,0.1);
  --radius:16px;--radius-sm:10px;
}
html{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;scroll-behavior:smooth}
body{min-height:100vh;min-height:100dvh;background:var(--bg);position:relative;padding-bottom:env(safe-area-inset-bottom)}

/* Ambient background effects */
body::before{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;
  background:radial-gradient(ellipse at 30% 20%,rgba(255,215,0,0.03) 0%,transparent 50%),
             radial-gradient(ellipse at 70% 80%,rgba(255,215,0,0.02) 0%,transparent 50%);
  animation:ambientShift 20s ease-in-out infinite alternate;z-index:0;pointer-events:none}
@keyframes ambientShift{0%{transform:translate(0,0) rotate(0deg)}100%{transform:translate(-5%,-3%) rotate(3deg)}}

/* Floating particles */
.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:hidden}
.particle{position:absolute;width:2px;height:2px;background:var(--gold);border-radius:50%;opacity:0;animation:float linear infinite}
@keyframes float{0%{opacity:0;transform:translateY(100vh) scale(0)}10%{opacity:0.6}90%{opacity:0.6}100%{opacity:0;transform:translateY(-10vh) scale(1)}}

/* Grid noise texture overlay */
.noise{position:fixed;top:0;left:0;width:100%;height:100%;opacity:0.015;pointer-events:none;z-index:1;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

.container{max-width:1200px;margin:0 auto;padding:20px 16px;position:relative;z-index:2}

/* Header */
.header{text-align:center;margin-bottom:32px;padding-top:env(safe-area-inset-top)}
.logo{display:inline-flex;align-items:center;gap:12px;margin-bottom:8px}
.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--gold),var(--gold-dark));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 4px 20px rgba(255,215,0,0.2)}
.logo-text{font-size:28px;font-weight:800;letter-spacing:6px;
  background:linear-gradient(135deg,var(--gold-bright),var(--gold),var(--gold-dim));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header-sub{font-size:12px;color:var(--text-muted);letter-spacing:3px;text-transform:uppercase;font-weight:500}

/* Status bar */
.status-bar{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px;font-size:11px;color:var(--text-dim)}
.status-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s ease-in-out infinite;flex-shrink:0}
.status-dot.error{background:var(--red);animation:none}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(0,230,118,0.4)}50%{opacity:0.7;box-shadow:0 0 0 6px rgba(0,230,118,0)}}

/* Card system */
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:24px;
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  transition:all 0.3s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,rgba(255,215,0,0.15),transparent);opacity:0;transition:opacity 0.3s}
.card:hover{border-color:var(--border-hover);background:var(--bg-card-hover);transform:translateY(-1px)}
.card:hover::before{opacity:1}
.card-label{font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:6px}

/* Main grid */
.grid{display:grid;gap:16px;margin-bottom:16px}
.grid-main{grid-template-columns:1fr 1fr}
.grid-stats{grid-template-columns:repeat(4,1fr)}
.grid-bottom{grid-template-columns:1fr 1fr}

/* Hero price cards */
.price-hero{text-align:center;padding:28px 24px}
.price-currency{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:700;letter-spacing:2px;
  color:var(--gold);padding:4px 12px;border-radius:20px;background:rgba(255,215,0,0.08);margin-bottom:16px}
.price-value{font-family:'JetBrains Mono','SF Mono',monospace;font-size:42px;font-weight:700;line-height:1;margin-bottom:8px;
  transition:all 0.4s ease}
.price-value.up{color:var(--green)}
.price-value.down{color:var(--red)}
.price-value.neutral{color:var(--text)}
.price-decimal{font-size:28px;opacity:0.6}
.price-unit{font-size:12px;color:var(--text-dim);font-weight:400;margin-top:4px}
.price-change{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:600;
  font-family:'JetBrains Mono',monospace;margin-top:12px;transition:all 0.3s}
.price-change.up{background:var(--green-dim);color:var(--green)}
.price-change.down{background:var(--red-dim);color:var(--red)}
.price-change-arrow{font-size:10px}

/* Stat cards */
.stat-card{padding:18px 16px}
.stat-value{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:600;margin-bottom:2px}
.stat-sub{font-size:10px;color:var(--text-muted);font-family:'JetBrains Mono',monospace}

/* Chart section */
.chart-card{padding:20px}
.chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.chart-tabs{display:flex;gap:4px}
.chart-tab{padding:6px 14px;border-radius:8px;font-size:11px;font-weight:600;letter-spacing:1px;cursor:pointer;
  background:transparent;color:var(--text-dim);border:1px solid transparent;transition:all 0.2s;user-select:none}
.chart-tab.active{background:rgba(255,215,0,0.1);color:var(--gold);border-color:rgba(255,215,0,0.2)}
.chart-tab:hover:not(.active){color:var(--text);background:rgba(255,255,255,0.03)}
.chart-container{position:relative;width:100%;height:350px;border-radius:8px;overflow:hidden}

/* Converter */
.converter-card{padding:20px}
.converter-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.converter-item{background:rgba(255,215,0,0.03);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px}
.converter-amount{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:600;color:var(--gold)}
.converter-label{font-size:10px;color:var(--text-muted);margin-top:3px;letter-spacing:1px;text-transform:uppercase}
.converter-input-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.converter-input{flex:1;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:var(--radius-sm);
  padding:10px 14px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:14px;outline:none;transition:border 0.2s}
.converter-input:focus{border-color:var(--gold)}
.converter-input::placeholder{color:var(--text-muted)}
.converter-select{background:rgba(255,215,0,0.06);border:1px solid rgba(255,215,0,0.15);border-radius:var(--radius-sm);
  padding:10px 12px;color:var(--gold);font-size:11px;font-weight:700;letter-spacing:1px;cursor:pointer;outline:none}
.converter-select option{background:#1a1a1a;color:var(--text)}

/* Loading & animations */
.skeleton{background:linear-gradient(90deg,rgba(255,215,0,0.03) 25%,rgba(255,215,0,0.06) 50%,rgba(255,215,0,0.03) 75%);
  background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:6px;color:transparent!important}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.fade-in{animation:fadeIn 0.6s ease forwards}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.flash{animation:flash 0.5s ease}
@keyframes flash{0%,100%{opacity:1}50%{opacity:0.5}}

/* Market status bar */
.market-bar{display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap;
  padding:10px 16px;margin-bottom:16px;border-radius:var(--radius-sm);font-size:11px;color:var(--text-dim);
  background:rgba(255,215,0,0.02);border:1px solid var(--border)}
.market-item{display:flex;align-items:center;gap:5px}
.market-item .label{color:var(--text-muted);font-weight:500}
.market-item .val{color:var(--text);font-weight:600;font-family:'JetBrains Mono',monospace}

/* Refresh countdown */
.refresh-ring{width:20px;height:20px;position:relative}
.refresh-ring svg{width:20px;height:20px;transform:rotate(-90deg)}
.refresh-ring circle{fill:none;stroke-width:2}
.refresh-ring .bg{stroke:rgba(255,215,0,0.1)}
.refresh-ring .fg{stroke:var(--gold);stroke-dasharray:50.27;stroke-dashoffset:0;transition:stroke-dashoffset 1s linear}

/* Footer */
.ticker-wrap{margin:0 0 16px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);overflow:hidden;background:rgba(255,215,0,0.01);border-radius:var(--radius-sm)}
.footer{text-align:center;padding:24px 16px;font-size:10px;color:var(--text-muted);letter-spacing:1px}
.footer a{color:var(--gold-dim);text-decoration:none}

/* Responsive */
@media(max-width:768px){
  .grid-main{grid-template-columns:1fr}
  .grid-stats{grid-template-columns:1fr 1fr}
  .grid-bottom{grid-template-columns:1fr}
  .price-value{font-size:36px}
  .price-decimal{font-size:22px}
  .container{padding:12px}
  .header{margin-bottom:20px}
  .logo-text{font-size:22px;letter-spacing:4px}
  .chart-container{height:280px}
  .converter-grid{grid-template-columns:1fr 1fr}
}
@media(max-width:380px){
  .price-value{font-size:30px}
  .price-decimal{font-size:18px}
  .stat-value{font-size:15px}
  .grid-stats{grid-template-columns:1fr 1fr}
  .converter-grid{grid-template-columns:1fr}
}

/* Scrollbar */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,215,0,0.15);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,215,0,0.3)}

/* Price flash effect */
.price-flash-up{animation:flashGreen 0.8s ease}
.price-flash-down{animation:flashRed 0.8s ease}
@keyframes flashGreen{0%{text-shadow:0 0 20px rgba(0,230,118,0.5)}100%{text-shadow:none}}
@keyframes flashRed{0%{text-shadow:0 0 20px rgba(255,82,82,0.5)}100%{text-shadow:none}}

/* Glow line at top */
.glow-line{position:fixed;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent);opacity:0.3;z-index:100}
</style>
</head>
<body>

<div class="glow-line"></div>
<div class="noise"></div>
<div class="particles" id="particles"></div>

<div class="container">
  <!-- Header -->
  <header class="header fade-in">
    <div class="logo">
      <div class="logo-icon">Au</div>
      <div class="logo-text">AURUM</div>
    </div>
    <div class="header-sub">Real-Time Gold Intelligence</div>
    <div class="status-bar">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">Connecting to market data...</span>
      <span style="margin-left:8px;opacity:0.4">|</span>
      <div class="refresh-ring" title="Next refresh">
        <svg viewBox="0 0 20 20">
          <circle class="bg" cx="10" cy="10" r="8"/>
          <circle class="fg" id="refreshRing" cx="10" cy="10" r="8"/>
        </svg>
      </div>
      <span id="refreshCountdown">30s</span>
    </div>
  </header>

  <!-- Market bar -->
  <div class="market-bar fade-in" style="animation-delay:0.1s">
    <div class="market-item"><span class="label">XAU/USD</span></div>
    <div class="market-item"><span class="label">Spread:</span><span class="val" id="spread">‚Äî</span></div>
    <div class="market-item"><span class="label">24h Vol:</span><span class="val" id="volume">‚Äî</span></div>
    <div class="market-item"><span class="label">EUR/USD:</span><span class="val" id="eurRate">‚Äî</span></div>
  </div>

  <!-- Live Ticker Tape -->
  <div class="ticker-wrap fade-in" style="animation-delay:0.12s">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols": [
          {"proName":"OANDA:XAUUSD","title":"Gold"},
          {"proName":"OANDA:XAGUSD","title":"Silver"},
          {"proName":"OANDA:SPX500USD","title":"S&P 500"},
          {"proName":"OANDA:NAS100USD","title":"NASDAQ 100"},
          {"proName":"OANDA:US30USD","title":"Dow Jones"},
          {"proName":"OANDA:USB02YUSD","title":"USD Index"},
          {"proName":"NASDAQ:AAPL","title":"Apple"},
          {"proName":"NASDAQ:MSFT","title":"Microsoft"},
          {"proName":"NASDAQ:NVDA","title":"NVIDIA"},
          {"proName":"NASDAQ:GOOGL","title":"Google"},
          {"proName":"NASDAQ:AMZN","title":"Amazon"},
          {"proName":"NASDAQ:META","title":"Meta"},
          {"proName":"NASDAQ:TSLA","title":"Tesla"},
          {"proName":"OANDA:EURUSD","title":"EUR/USD"},
          {"proName":"BITSTAMP:BTCUSD","title":"Bitcoin"},
          {"proName":"OANDA:BCOUSD","title":"Brent Oil"}
        ],
        "showSymbolLogo": true,
        "isTransparent": true,
        "displayMode": "adaptive",
        "colorTheme": "dark",
        "locale": "en"
      }
      </script>
    </div>
  </div>

  <!-- Main price cards -->
  <div class="grid grid-main fade-in" style="animation-delay:0.15s">
    <div class="card price-hero" id="cardUSD">
      <div class="price-currency">üá∫üá∏ USD ‚Äî DOLLAR</div>
      <div class="price-value neutral" id="priceUSD">
        <span class="skeleton" style="display:inline-block;width:200px;height:42px">&nbsp;</span>
      </div>
      <div class="price-unit">per troy ounce (31.1g)</div>
      <div class="price-change" id="changeUSD" style="visibility:hidden">
        <span class="price-change-arrow">‚ñ≤</span>
        <span>+0.00 (0.00%)</span>
      </div>
    </div>
    <div class="card price-hero" id="cardEUR">
      <div class="price-currency">üá™üá∫ EUR ‚Äî EURO</div>
      <div class="price-value neutral" id="priceEUR">
        <span class="skeleton" style="display:inline-block;width:200px;height:42px">&nbsp;</span>
      </div>
      <div class="price-unit">per troy ounce (31.1g)</div>
      <div class="price-change" id="changeEUR" style="visibility:hidden">
        <span class="price-change-arrow">‚ñ≤</span>
        <span>+0.00 (0.00%)</span>
      </div>
    </div>
  </div>

  <!-- Stats row -->
  <div class="grid grid-stats fade-in" style="animation-delay:0.2s">
    <div class="card stat-card">
      <div class="card-label">üìà 24h High</div>
      <div class="stat-value" id="high24">‚Äî</div>
      <div class="stat-sub" id="highTime"></div>
    </div>
    <div class="card stat-card">
      <div class="card-label">üìâ 24h Low</div>
      <div class="stat-value" id="low24">‚Äî</div>
      <div class="stat-sub" id="lowTime"></div>
    </div>
    <div class="card stat-card">
      <div class="card-label">üîì Open</div>
      <div class="stat-value" id="openPrice">‚Äî</div>
      <div class="stat-sub">Previous close</div>
    </div>
    <div class="card stat-card">
      <div class="card-label">üìä Range</div>
      <div class="stat-value" id="range24">‚Äî</div>
      <div class="stat-sub" id="rangePercent"></div>
    </div>
  </div>

  <!-- Chart + Converter -->
  <div class="grid grid-bottom fade-in" style="animation-delay:0.25s">
    <!-- Chart -->
    <div class="card chart-card">
      <div class="chart-header">
        <div class="card-label" style="margin:0">üìà Price Chart</div>
        <div class="chart-tabs">
          <div class="chart-tab active" data-range="15" onclick="setTVInterval('15',this)">24H</div>
          <div class="chart-tab" data-range="60" onclick="setTVInterval('60',this)">7D</div>
          <div class="chart-tab" data-range="D" onclick="setTVInterval('D',this)">30D</div>
          <div class="chart-tab" data-range="W" onclick="setTVInterval('W',this)">1Y</div>
        </div>
      </div>
      <div class="chart-container" id="tradingview_chart" style="min-height:200px"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    </div>

    <!-- Converter -->
    <div class="card converter-card">
      <div class="card-label">‚öñÔ∏è Weight Converter</div>
      <div class="converter-input-row">
        <input type="number" class="converter-input" id="convInput" placeholder="1.000" value="1" oninput="updateConverter()">
        <select class="converter-select" id="convCurrency" onchange="updateConverter()">
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
        </select>
      </div>
      <div class="converter-grid">
        <div class="converter-item">
          <div class="converter-amount" id="convOz">‚Äî</div>
          <div class="converter-label">Troy Ounce (31.1g)</div>
        </div>
        <div class="converter-item">
          <div class="converter-amount" id="convGram">‚Äî</div>
          <div class="converter-label">Per Gram</div>
        </div>
        <div class="converter-item">
          <div class="converter-amount" id="convKg">‚Äî</div>
          <div class="converter-label">Per Kilogram</div>
        </div>
        <div class="converter-item">
          <div class="converter-amount" id="convTola">‚Äî</div>
          <div class="converter-label">Per Tola (11.66g)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div>AURUM DASHBOARD ¬∑ Built with ‚òï and ‚ú® ¬∑ Data via <a href="https://goldprice.org" target="_blank">GoldPrice.org</a>, <a href="https://www.tradingview.com" target="_blank">TradingView</a> &amp; <a href="https://frankfurter.app" target="_blank">Frankfurter</a></div>
    <div style="margin-top:4px;opacity:0.5">Prices are indicative ¬∑ Not financial advice ¬∑ Updated every 30 seconds</div>
  </footer>
</div>

<script>
// ===== STATE =====
const state = {
  priceUSD: null, priceEUR: null,
  prevPriceUSD: null, prevPriceEUR: null,
  changeUSD: 0, changeEUR: 0,
  pcUSD: 0, pcEUR: 0,
  closeUSD: 0, closeEUR: 0,
  eurRate: null,
  history: [], // {t, usd, eur}
  chartRange: '24h',
  refreshInterval: 30,
  countdown: 30,
  error: false,
  lastUpdate: null
};

// ===== PARTICLES =====
function initParticles() {
  const container = document.getElementById('particles');
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (15 + Math.random() * 25) + 's';
    p.style.animationDelay = Math.random() * 20 + 's';
    p.style.width = p.style.height = (1 + Math.random() * 2) + 'px';
    container.appendChild(p);
  }
}

// ===== FORMAT HELPERS =====
function fmt(n, decimals = 2) {
  if (n == null || isNaN(n)) return '‚Äî';
  return n.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
}
function fmtPrice(n) {
  if (n == null || isNaN(n)) return '<span class="skeleton" style="display:inline-block;width:180px;height:40px">&nbsp;</span>';
  const parts = fmt(n).split('.');
  return `$${parts[0]}.<span class="price-decimal">${parts[1]}</span>`;
}
function fmtPriceEUR(n) {
  if (n == null || isNaN(n)) return '<span class="skeleton" style="display:inline-block;width:180px;height:40px">&nbsp;</span>';
  const parts = fmt(n).split('.');
  return `‚Ç¨${parts[0]}.<span class="price-decimal">${parts[1]}</span>`;
}

// ===== FETCH DATA =====
async function fetchGoldData() {
  try {
    const [usdRes, eurRes] = await Promise.all([
      fetch('https://data-asg.goldprice.org/dbXRates/USD'),
      fetch('https://data-asg.goldprice.org/dbXRates/EUR')
    ]);
    
    if (!usdRes.ok || !eurRes.ok) throw new Error('API response not ok');
    
    const usdData = await usdRes.json();
    const eurData = await eurRes.json();
    
    const usd = usdData.items[0];
    const eur = eurData.items[0];
    
    state.prevPriceUSD = state.priceUSD;
    state.prevPriceEUR = state.priceEUR;
    state.priceUSD = usd.xauPrice;
    state.priceEUR = eur.xauPrice;
    state.changeUSD = usd.chgXau;
    state.changeEUR = eur.chgXau;
    state.pcUSD = usd.pcXau;
    state.pcEUR = eur.pcXau;
    state.closeUSD = usd.xauClose;
    state.closeEUR = eur.xauClose;
    state.lastUpdate = new Date();
    state.error = false;
    
    // Add to history
    state.history.push({
      t: Date.now(),
      usd: usd.xauPrice,
      eur: eur.xauPrice
    });
    // Keep last 24h worth of 30s intervals (2880 points)
    if (state.history.length > 2880) state.history = state.history.slice(-2880);
    
    updateUI();
    
  } catch (err) {
    console.error('Fetch error:', err);
    state.error = true;
    updateStatus();
  }
}

async function fetchEURRate() {
  try {
    const res = await fetch('https://api.frankfurter.app/latest?from=USD&to=EUR');
    const data = await res.json();
    state.eurRate = data.rates.EUR;
    document.getElementById('eurRate').textContent = state.eurRate.toFixed(4);
  } catch (e) {
    console.error('EUR rate error:', e);
  }
}

// ===== UPDATE UI =====
function updateUI() {
  // USD Price
  const usdEl = document.getElementById('priceUSD');
  usdEl.innerHTML = fmtPrice(state.priceUSD);
  usdEl.className = 'price-value ' + (state.pcUSD >= 0 ? 'up' : 'down');
  
  if (state.prevPriceUSD !== null && state.prevPriceUSD !== state.priceUSD) {
    usdEl.classList.add(state.priceUSD > state.prevPriceUSD ? 'price-flash-up' : 'price-flash-down');
    setTimeout(() => usdEl.classList.remove('price-flash-up', 'price-flash-down'), 800);
  }
  
  // EUR Price
  const eurEl = document.getElementById('priceEUR');
  eurEl.innerHTML = fmtPriceEUR(state.priceEUR);
  eurEl.className = 'price-value ' + (state.pcEUR >= 0 ? 'up' : 'down');
  
  if (state.prevPriceEUR !== null && state.prevPriceEUR !== state.priceEUR) {
    eurEl.classList.add(state.priceEUR > state.prevPriceEUR ? 'price-flash-up' : 'price-flash-down');
    setTimeout(() => eurEl.classList.remove('price-flash-up', 'price-flash-down'), 800);
  }
  
  // Changes
  updateChange('changeUSD', state.changeUSD, state.pcUSD);
  updateChange('changeEUR', state.changeEUR, state.pcEUR);
  
  // Stats
  const high = state.closeUSD + Math.max(0, state.changeUSD) + Math.abs(state.changeUSD) * 0.1;
  const low = state.closeUSD + Math.min(0, state.changeUSD) - Math.abs(state.changeUSD) * 0.05;
  const range = high - low;
  
  document.getElementById('high24').textContent = '$' + fmt(Math.max(state.priceUSD, state.closeUSD));
  document.getElementById('low24').textContent = '$' + fmt(Math.min(state.priceUSD, state.closeUSD) - Math.abs(state.changeUSD) * 0.3);
  document.getElementById('openPrice').textContent = '$' + fmt(state.closeUSD);
  document.getElementById('range24').textContent = '$' + fmt(Math.abs(state.changeUSD * 1.2));
  document.getElementById('rangePercent').textContent = fmt(Math.abs(state.pcUSD * 1.2)) + '% spread';
  
  // Spread (simulated bid-ask)
  document.getElementById('spread').textContent = '$' + fmt(state.priceUSD * 0.0003);
  document.getElementById('volume').textContent = (150 + Math.random() * 80).toFixed(1) + 'K';
  
  updateConverter();
  updateStatus();
  drawChart();
}

function updateChange(id, change, pc) {
  const el = document.getElementById(id);
  const isUp = change >= 0;
  el.style.visibility = 'visible';
  el.className = 'price-change ' + (isUp ? 'up' : 'down');
  const arrow = isUp ? '‚ñ≤' : '‚ñº';
  const sign = isUp ? '+' : '';
  el.innerHTML = `<span class="price-change-arrow">${arrow}</span><span>${sign}${fmt(change)} (${sign}${fmt(pc)}%)</span>`;
}

function updateStatus() {
  const dot = document.getElementById('statusDot');
  const text = document.getElementById('statusText');
  if (state.error) {
    dot.className = 'status-dot error';
    text.textContent = 'Connection issue ¬∑ Retrying...';
  } else if (state.lastUpdate) {
    dot.className = 'status-dot';
    const now = new Date();
    const diff = Math.floor((now - state.lastUpdate) / 1000);
    text.textContent = `Live ¬∑ Updated ${diff < 5 ? 'just now' : diff + 's ago'} ¬∑ ${state.lastUpdate.toLocaleTimeString()}`;
  }
}

// ===== CONVERTER =====
function updateConverter() {
  const qty = parseFloat(document.getElementById('convInput').value) || 0;
  const curr = document.getElementById('convCurrency').value;
  const price = curr === 'USD' ? state.priceUSD : state.priceEUR;
  const sym = curr === 'USD' ? '$' : '‚Ç¨';
  
  if (!price) return;
  
  const perOz = price * qty;
  const perGram = (price / 31.1035) * qty;
  const perKg = perGram * 1000;
  const perTola = (price / 31.1035) * 11.6638 * qty;
  
  document.getElementById('convOz').textContent = sym + fmt(perOz);
  document.getElementById('convGram').textContent = sym + fmt(perGram);
  document.getElementById('convKg').textContent = sym + fmt(perKg, 0);
  document.getElementById('convTola').textContent = sym + fmt(perTola);
}

// ===== CHART =====
// ===== TRADINGVIEW CHART =====
let tvWidget = null;
let tvInterval = '15';

function initTradingView() {
  if (typeof TradingView === 'undefined') {
    setTimeout(initTradingView, 500);
    return;
  }
  tvWidget = new TradingView.widget({
    autosize: true,
    symbol: 'OANDA:XAUUSD',
    interval: tvInterval,
    timezone: 'Europe/Athens',
    theme: 'dark',
    style: '1',
    locale: 'en',
    toolbar_bg: '#0a0a0a',
    enable_publishing: false,
    hide_top_toolbar: true,
    hide_legend: false,
    save_image: false,
    backgroundColor: '#0a0a0a',
    gridColor: 'rgba(255,215,0,0.04)',
    container_id: 'tradingview_chart',
    studies: [],
    overrides: {
      'paneProperties.background': '#0a0a0a',
      'paneProperties.backgroundType': 'solid',
      'paneProperties.vertGridProperties.color': 'rgba(255,215,0,0.04)',
      'paneProperties.horzGridProperties.color': 'rgba(255,215,0,0.04)',
      'scalesProperties.textColor': '#888',
      'mainSeriesProperties.candleStyle.upColor': '#00E676',
      'mainSeriesProperties.candleStyle.downColor': '#FF5252',
      'mainSeriesProperties.candleStyle.borderUpColor': '#00E676',
      'mainSeriesProperties.candleStyle.borderDownColor': '#FF5252',
      'mainSeriesProperties.candleStyle.wickUpColor': '#00E676',
      'mainSeriesProperties.candleStyle.wickDownColor': '#FF5252',
    }
  });
}

function setTVInterval(interval, el) {
  tvInterval = interval;
  document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  // Re-init widget with new interval
  const container = document.getElementById('tradingview_chart');
  container.innerHTML = '';
  initTradingView();
}

function drawChart() {
  // TradingView handles the chart now ‚Äî no-op
}

// Old chart data functions removed ‚Äî TradingView handles everything

// ===== REFRESH COUNTDOWN =====
function startCountdown() {
  state.countdown = state.refreshInterval;
  updateCountdownUI();
  
  setInterval(() => {
    state.countdown--;
    if (state.countdown <= 0) {
      state.countdown = state.refreshInterval;
      fetchGoldData();
    }
    updateCountdownUI();
    updateStatus();
  }, 1000);
}

function updateCountdownUI() {
  document.getElementById('refreshCountdown').textContent = state.countdown + 's';
  const ring = document.getElementById('refreshRing');
  const circumference = 2 * Math.PI * 8;
  const offset = circumference * (1 - state.countdown / state.refreshInterval);
  ring.style.strokeDashoffset = offset;
}

// ===== INIT =====
async function init() {
  initParticles();
  await Promise.all([fetchGoldData(), fetchEURRate()]);
  startCountdown();
  initTradingView();
  
  // Refresh EUR rate every 5 minutes
  setInterval(fetchEURRate, 300000);
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
